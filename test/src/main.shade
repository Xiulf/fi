module Main =

import Core
import Core.Ops (Concat, concat)
import Js.Console

@main
main :: Option ()
main = try
    a <- Some { a = 23, b = 24, c = 25 }
    ret $ print a test

test :: Writer Str ()
test = try
    write "abc"
    write "def"
    write "ghi"
    ret ()

class Write w m | m -> w where Try m = 
    write :: w -> m ()

type Writer w a = | Writer (a, w)

member w (Writer w) of Write where Default w, Concat w w =
    write x = Writer ((), x)

member (Writer w) of Try where Default w, Concat w w =
    ret x = Writer (x, default)
    
    bind (Writer (a, w)) f =
        let (a', w') = runWriter (f a)
        Writer (a', concat w w')

runWriter :: forall w a. Writer w a -> (a, w)
runWriter (Writer x) = x
